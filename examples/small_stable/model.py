import numpy as np

from dmpcpwa.utils.pwa_models import cent_from_dist


def get_IC():
    return 1 * np.array([[-1.9, 1.2, 0.1, 1.6, 1.9, -1.6]]).T
    # return 1 * np.array([[-1.9, 0.7, -1.5, -1.3, 1.9, -1.4]]).T
    # return 1 * np.array([[-1.9, 0.7, -1.6, 0.5, 1.2, 0.9]]).T


Q_x = np.array([[1, 0], [0, 1]])
Q_u = 1 * np.array([[1]])


def get_cost_matrices():
    return Q_x, Q_u


A1 = np.array([[1, 0.8], [0, 1.15]])
A2 = np.array([[1, 0.9], [0, 1.2]])
A3 = np.array([[1, 0.95], [0, 1.2]])
A4 = np.array([[1, 0.85], [0, 1.15]])
A5 = np.array([[1, 0.8], [0, 1.1]])

np.linalg.eig(A1)

B1 = np.array([[1], [0.3]])
B2 = np.array([[1], [0.3]])
B3 = np.array([[1.2], [0.3]])
B4 = np.array([[1], [0.3]])
B5 = np.array([[1], [0.3]])

c1 = np.zeros((2, 1))
c2 = np.zeros((2, 1))
c3 = np.zeros((2, 1))
c4 = np.zeros((2, 1))
c5 = np.array([[-0.1], [0.1]])

A = [A1, A2, A3, A4, A5]
B = [B1, B2, B3, B4, B5]
c = [c1, c2, c3, c4, c5]

D = np.array([[1, 0], [-1, 0], [0, 1], [0, -1]])
E = np.array([[2], [2], [2], [2]])

u_lim = 1
F = np.array([[1], [-1]])
G = np.array([[u_lim], [u_lim]])

S1 = np.array([[-1, 0], [0, -1], [0, 0]])
R1 = np.zeros((3, 1))
T1 = np.zeros((3, 1))

S2 = np.array([[1, 0], [0, -1], [-1, 1]])
R2 = np.zeros((3, 1))
T2 = np.array([[0], [0], [0.5]])

S3 = np.array([[1, 0], [0, 1], [0, 0]])
R3 = np.zeros((3, 1))
T3 = np.zeros((3, 1))

S4 = np.array([[-1, 0], [0, 1], [0, 0]])
R4 = np.zeros((3, 1))
T4 = np.zeros((3, 1))

S5 = np.array([[1, 0], [0, -1], [1, -1]])
R5 = np.zeros((3, 1))
T5 = np.array([[0], [0], [-0.5]])

S = [S1, S2, S3, S4, S5]
R = [R1, R2, R3, R4, R5]
T = [T1, T2, T3, T4, T5]


def get_local_system():
    return {
        "S": S,
        "R": R,
        "T": T,
        "A": A,
        "B": B,
        "c": c,
        "D": D,
        "E": E,
        "F": F,
        "G": G,
    }


Adj = np.array([[0, 1, 0], [1, 0, 1], [1, 0, 0]])
A_c1 = 4e-3 * np.ones((2, 2))
A_c2 = 2e-3 * np.ones((2, 2))


def get_cent_system():
    # system 1
    sys_1 = get_local_system()
    sys_1["Ac"] = [[A_c1] for i in range(5)]

    # system 2
    sys_2 = get_local_system()
    sys_2["Ac"] = [[A_c2, A_c2] for i in range(5)]

    # system 3
    sys_3 = get_local_system()
    sys_3["Ac"] = [[A_c1] for i in range(5)]

    return cent_from_dist([sys_1, sys_2, sys_3], Adj)


def get_local_coupled_systems():
    # manually construct system descriptions and coupling
    system = get_local_system()
    systems = []  # list of systems, 1 for each agent
    systems.append(system.copy())
    Ac_i = [A_c1]
    systems[0]["Ac"] = []
    for i in range(len(system["S"])):
        systems[0]["Ac"] = systems[0]["Ac"] + [Ac_i]

    systems.append(system.copy())
    Ac_i = [A_c2, A_c2]
    systems[1]["Ac"] = []
    for i in range(len(system["S"])):
        systems[1]["Ac"] = systems[1]["Ac"] + [Ac_i]

    systems.append(system.copy())
    Ac_i = [A_c1]
    systems[2]["Ac"] = []
    for i in range(len(system["S"])):
        systems[2]["Ac"] = systems[2]["Ac"] + [Ac_i]

    return systems


def get_adj():
    return Adj


def get_A_c1():
    return A_c1


def get_A_c2():
    return A_c2


# invariant set
A_t = np.array(
    [
        [-0.838167327304677, 2.51323092851876],
        [0.585508344938054, -1.75631719114707],
        [0.541654381033104, -0.775688909303791],
        [-0.476973740057866, 0.850220570513130],
        [-0.201101499285382, 1.43646188576863],
        [0.0878243840517243, -0.841682655544037],
        [-0.538619343812254, 2.37460628225254],
        [0.349690037777757, -1.57977900076078],
        [-0.656168180152136, 2.63105086621010],
        [0.446354103490724, -1.80464637275753],
        [-0.659574109903369, 2.54239695824888],
        [0.456622901487060, -1.76715355410731],
        [-0.880304361905936, 2.85024201553224],
        [0.613962474041644, -1.98974691126937],
        [-0.826308401398932, 2.53188349781508],
        [0.577500296627462, -1.77021376036799],
        [-0.844222949043780, 2.48914879864801],
        [0.589597561096654, -1.73907940396705],
        [-0.717764117593537, 2.04305646158912],
        [0.501691486678731, -1.42830157647150],
        [-0.730865407961130, 2.10251451801120],
        [0.511096575648060, -1.47057270266255],
        [-0.704828966531172, 1.98896631663900],
        [0.492538113030303, -1.39018540377949],
        [0.411104161913566, -1.14484689500220],
    ]
)
b_t = np.array(
    [
        [
            0.195206369510529,
            0.132640535827569,
            0.323909319857796,
            0.222757789474440,
            0.313370573535101,
            0.212140234989872,
            0.300270066454669,
            0.204704178673106,
            0.276964261446150,
            0.189268426364798,
            0.250666509075253,
            0.171260422554812,
            0.225050740530035,
            0.153470210910057,
            0.195206369510529,
            0.132640535827569,
            0.195206369510529,
            0.132640535827569,
            0.168395183463942,
            0.113905931538888,
            0.168340834316817,
            0.113858823371605,
            0.168539395528995,
            0.114011120107059,
            0.0980054691451204,
        ]
    ]
).T


def get_inv_set():
    return A_t, b_t


warm_start_u = [
    np.array(
        [
            [
                0.292669560002620,
                -0.430294745913984,
                -0.858237535006383,
                -0.999999955533112,
                -0.999999612100781,
                -0.999998328320087,
                -0.999996847514787,
                -0.999999999966777,
                -0.999999999999993,
                -0.999999431711075,
                -0.999999999357549,
                -0.673521200393321,
                -0.999999999591643,
                -0.796037733884166,
                -0.604497481989955,
                -0.386749514966132,
                -0.790401438228276,
                -0.623915741338535,
                -0.470492727082317,
                -0.344769106867796,
                -0.249732929469479,
                -0.178714647813913,
                -0.124146127927431,
                -0.0934326052584045,
                -0.0664094606638998,
                -0.0431565177219463,
                -0.0240255436374383,
                -0.0196680161076492,
                -0.0124300161761479,
                -0.00939144610105703,
                -0.00696559730982013,
                -0.00237648752318723,
                -0.00660025810848540,
                -0.00239592362216645,
                0.00208298281107998,
                0.00188766013148635,
                -0.00192529934712589,
                0.000337391210355471,
                0.000931773285125164,
                -0.00209979044573828,
                -0.00227454599479906,
                0.00156830309903551,
                0.000236165168238746,
                0.00319497414393471,
                -0.000611306439017059,
                -0.00260834831579280,
                0.000309858932043028,
                -0.00422612441812558,
                0.000283845048421278,
                -0.00401097476389253,
                -0.00381060839966938,
                -0.00184564981263977,
                -0.00159422761594577,
                -0.000871984648596490,
                -0.00266460704233577,
                -0.000947533617703226,
                -0.00221613051186953,
                -0.000460677720677635,
                0.00660369738761081,
                0.0102829461625416,
                0.0105456108195207,
                0.00460982653125080,
                0.00230204571322755,
                0.00152617630422286,
                0.00449921630334362,
                0.00818674161779885,
                0.00563378064857694,
                0.00625369103361518,
                0.00811413899921095,
                0.00772591811160405,
                0.00116775188558911,
                -0.00190917764350296,
                -0.000417281764839647,
                -0.000505987234925643,
                0.000661001981173248,
                -0.00516872180086227,
                0.000360471435958677,
                -0.00164452078878023,
                0.00109943857565050,
                -0.00232897594204189,
                -0.00221197919514505,
                -0.00266949314587947,
                -0.00409431033356579,
                -0.00341046622075974,
                -0.00220520472843448,
                -0.00111412345626247,
                -0.000484198212006982,
                0.000493385741359488,
                -0.00371712895519809,
                -0.00214112782815505,
                5.41781061508843e-05,
                0.00446273109673408,
                0.00459071147133903,
                -0.00429969129157777,
                -0.000248523492714725,
                -0.000489460011038049,
                0.00104802957755624,
                0.000893391158692920,
                -0.00345157037090617,
                -0.000509936942249927,
            ]
        ]
    ),
    np.array(
        [
            [
                -0.924283019703031,
                -0.999997503868943,
                -0.999999661438081,
                -0.999999999943736,
                -0.999999759450233,
                -0.999999939926696,
                -0.999999717818341,
                -0.999474160233640,
                -0.684045382482902,
                -0.453637243919949,
                -0.426148823379025,
                -0.107764440372894,
                -0.924121024257044,
                -0.500233060269130,
                -0.763232622793768,
                -0.606014334042139,
                -0.461228332522468,
                -0.342423879216746,
                -0.248895298285130,
                -0.177388952622950,
                -0.130246585902167,
                -0.0903171751728817,
                -0.0634677077781328,
                -0.0407979675220350,
                -0.0246270900880371,
                -0.0122705338491992,
                -0.00763819814708503,
                -0.00384149418902528,
                -0.00361050864455635,
                -0.00605984334685961,
                0.00241164693887005,
                0.00203743875155041,
                0.00454633767958374,
                0.00661014623993662,
                0.00682458154464201,
                0.00944065588897461,
                0.00963601981307692,
                0.00533694301037752,
                0.00809271430815017,
                0.000766889055630302,
                0.00628570593389704,
                0.00198390869194220,
                0.00195878447093638,
                0.000871711658637198,
                0.00710600106021150,
                0.00352938000634036,
                0.000777578172861781,
                0.00556247668064555,
                0.00652706531897391,
                0.00399958901940936,
                0.00351505905031733,
                0.00719960436035039,
                0.00292179051504245,
                -0.000727201534837213,
                0.00496819230635056,
                -5.73761153508205e-05,
                0.00922278331385080,
                0.00816538949402187,
                0.00998768277685829,
                -0.00194725092761154,
                -0.00435997665838704,
                -0.00271404584502872,
                -0.00102419391102406,
                -0.00178891411633740,
                0.000183177789107373,
                -0.00131221298156701,
                -0.00246574955616161,
                -0.00307503025569621,
                -0.00116709952444891,
                0.00426670316148706,
                0.000838472622572025,
                0.00311390461806875,
                0.00898053054684406,
                0.00446412396883639,
                0.00636236322156975,
                0.00579527182256295,
                0.00497863974405674,
                0.00921970269641702,
                0.0107089223226552,
                0.0121043284792559,
                0.00377012900598826,
                0.00670640698731977,
                0.00811503713992146,
                -0.00205444745642227,
                -0.00499226321834968,
                -0.00287650552278236,
                -0.00220988954221279,
                -0.00200783588424516,
                0.00241892984118888,
                0.00620045981379051,
                0.00118332277078289,
                -0.000660726325219956,
                -0.00113155781472608,
                0.00738224274517065,
                0.00669018657011754,
                0.00732308382761422,
                0.00774913610842116,
                0.00466070897410109,
                -0.00154795952914714,
                -0.00154897963688943,
            ]
        ]
    ),
    np.array(
        [
            [
                0.818946175637424,
                0.964468007287607,
                0.967975184632633,
                0.967694242684592,
                0.974590356273790,
                0.979736867944830,
                0.985234552322127,
                0.906869725909127,
                0.905784609814371,
                0.717790412558699,
                0.522940285264274,
                0.485131871521731,
                0.529767418214618,
                0.492882360035030,
                0.328127625966269,
                0.484685264494969,
                0.255502703881500,
                0.317842117764096,
                0.182801428014820,
                0.0396156192172210,
                0.394006012774278,
                0.324105648111995,
                0.455745603927291,
                0.356877354327767,
                0.471394866784837,
                0.360458332106101,
                0.365388953514870,
                0.339926748617137,
                0.400335933479760,
                0.572379057920886,
                -0.0409669496558651,
                0.301884767005526,
                0.219320915647567,
                0.234174857446268,
                -0.0709279012269443,
                0.375663282091526,
                0.434241333651188,
                0.423242982873593,
                0.381760125455653,
                0.329361559580354,
                0.279172885605741,
                0.234100490607360,
                0.189936666716086,
                0.150344908830053,
                0.123409482145389,
                0.0964850811661548,
                0.0817235056423291,
                0.0674071922785375,
                0.0561487869562572,
                0.0449939794778632,
                0.0350484498363915,
                0.0289698882118856,
                0.0199367784593492,
                0.00787709468268275,
                0.00876127878755529,
                0.00782966231794478,
                0.00149149038007847,
                -0.000705488908381766,
                0.00111520376203654,
                0.00585301963177646,
                0.00944655455915061,
                0.00691173652712434,
                0.00814285819249304,
                -4.21371621728631e-06,
                -0.00161177910169849,
                -0.00244634685774190,
                -0.00361561510898341,
                -0.00191205677592739,
                0.00235282050656446,
                -0.00321817867091736,
                0.000743359853911470,
                -0.00322608793346904,
                -8.52426321504892e-05,
                2.02803878888453e-05,
                -0.00105842804768239,
                -0.00117454181985988,
                -0.00305991397887828,
                -0.00279854035091473,
                0.000227480815303505,
                0.00378216147824358,
                -0.00161643641575912,
                -0.00641004698759700,
                -0.000830116823273113,
                -0.00217415377130712,
                -0.00353879357731441,
                0.00139570478031997,
                0.000894359709718035,
                0.000966568151042681,
                0.00498824773358495,
                0.00721328174162765,
                7.75627259709767e-05,
                -0.00203906215279330,
                -0.00408647102310663,
                0.00197119889284510,
                -0.00296420248691290,
                -0.00112843176183774,
                -0.000604200800740796,
                -0.00238905990321534,
                0.00551521869665073,
                0.00281270803855873,
            ]
        ]
    ),
]


def get_warm_start(N):
    return [warm_start_u[i][:, :N] for i in range(3)]
